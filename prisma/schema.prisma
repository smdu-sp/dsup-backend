// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Permissao {
  DEV
  ADM
  TEC
  USR
}

model Usuario {
  id            String      @id @default(uuid())
  nome          String
  login         String      @unique
  email         String      @unique
  permissao     Permissao   @default(USR)
  status        Int         @default(1)

  ultimologin   DateTime    @default(now())
  criadoEm      DateTime    @default(now())
  atualizadoEm  DateTime    @default(now()) @updatedAt

  ordens      Ordem[]
  servicos    Servico[]
  unidade     Unidade?   @relation(fields: [unidade_id], references: [id])
  unidade_id  String?

  @@map("usuarios")
}

model Unidade {
  id        String    @id @default(uuid())
  nome      String    @unique
  sigla     String    @unique
  codigo    String    @unique
  status    Boolean   @default(true)

  usuarios  Usuario[]
  ordens    Ordem[]

  @@map("unidades")
}

model Ordem {
  id                String    @id
  unidade_id        String
  unidade           Unidade   @relation(fields: [unidade_id], references: [id])
  andar             Int
  sala              String
  solicitante       Usuario   @relation(fields: [solicitante_id], references: [id])
  solicitante_id    String
  data_solicitacao  DateTime  @default(now())
  tipo              Int       @default(0)
  status            Int       @default(1)
  prioridade        Int       @default(1)
  observacoes       String
  servicos          Servico[]

  @@map("ordens")
}

model Servico {
  id                  String              @id @default(uuid())
  tecnico             Usuario             @relation(fields: [tecnico_id], references: [id])
  tecnico_id          String
  data_inicio         DateTime            @default(now())
  servicos_materiais  Servico_Material[]
  suspensoes          Suspensao[]
  ordem               Ordem               @relation(fields: [ordem_id], references: [id])
  ordem_id            String
  concluido_em        DateTime?
  status              Int                 @default(1)
  observacao          String?

  @@map("servicos")
}

model Suspensao {
  id                  String              @id @default(uuid())
  servico_id          String
  servico             Servico             @relation(fields: [servico_id], references: [id])
  motivo              String
  status              Boolean             @default(true)

  @@map("suspensoes")
}

model Material {
  id                  String              @id @default(uuid())
  nome                String              @unique
  servicos_materiais  Servico_Material[]

  @@map("materiais")
}

model Servico_Material {
  servico     Servico   @relation(fields: [servico_id], references: [id])
  servico_id  String
  material    Material  @relation(fields: [material_id], references: [id])
  material_id String
  quantidade  Int
  medida      String

  @@unique([servico_id, material_id])
  @@map("servicos_materiais")
}